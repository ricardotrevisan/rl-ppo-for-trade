Training device: cpu
Config: window_size=20, risk_window=20, reward_mode=risk_adj, train=(2022-01-01→2023-01-01), eval=(2023-01-02→2025-12-31)

=== Run Parameters ===
{
  "batch_size": 4096,
  "clip_range": 0.2,
  "dd_penalty": 0.05,
  "deterministic": true,
  "device": "cpu",
  "downside_only": false,
  "effective_num_envs": 1,
  "ent_coef": 0.01,
  "eval_end": "2025-12-31",
  "eval_slices": null,
  "eval_start": "2023-01-02",
  "inv_mom_penalty": 0.02,
  "learning_rate": 0.0003,
  "log_action_probs": 0,
  "loss_penalty": 0.1,
  "lot_size": 100,
  "max_trade_fraction": 0.1,
  "mode": "train",
  "n_epochs": 10,
  "n_steps": 2048,
  "num_envs": 1,
  "print_params": true,
  "reward_mode": "risk_adj",
  "risk_window": 20,
  "seed": 42,
  "sell_turnover_factor": 0.5,
  "ticker": "PETR4.SA",
  "total_timesteps": 40000,
  "train_end": "2023-01-01",
  "train_start": "2022-01-01",
  "turnover_penalty": 0.002,
  "window_size": 20
}
======================


============================================================
Treinando novos modelos PPO e A2C...
📁 Usando cache existente: data/PETR4.SA_2022-01-01_2023-01-01.csv
📁 Carregando dados de cache: data/PETR4.SA_2022-01-01_2023-01-01.csv
📁 Carregando dados de cache: data/PETR4.SA_2022-01-01_2023-01-01.csv
Parallel envs: 1

Treinando PPO...
 100% ━━━━━━━━━━━━━━━━━━━━━━━━ 40,960/40,000  [ 0:00:23 < 0:00:00 , 1,722 it/s ]
✓ PPO concluído!

✓ Melhor modelo salvo: best_trading_model_PPO.zip

============================================================
Executando modelo e coletando métricas...

============================================================
Executando avaliação: 2023-01-02 → 2025-12-31 [main]
📁 Usando cache existente: data/PETR4.SA_2023-01-02_2025-12-31.csv
📁 Carregando dados de cache: data/PETR4.SA_2023-01-02_2025-12-31.csv
✓ VecNormalize carregado para avaliação (norm_obs=True, norm_reward=False)
Retorno buy-and-hold (slice):   124.13%
✓ Trades salvos em trade_log_detailed.csv
Trades coletados: 579  |  Trades no env (pós-reset): 0
Ações escolhidas: hold=6, buy=182, sell=497
Trades efetivados (durante avaliação): 579

============================================================
📊 MÉTRICAS FINANCEIRAS DO MODELO
Retorno total:           15.90%
Retorno médio diário:   0.0231%
Volatilidade anual:       9.00%
Sharpe Ratio:            0.647
Máximo Drawdown:        -11.59%
============================================================
✓ Gráficos e métricas gerados com sucesso!
